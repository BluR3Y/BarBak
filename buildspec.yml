version: 0.2
env:
  secrets-manager:
    DOCKER_ID: "arn:aws:secretsmanager:us-east-1:637574709554:secret:barbak-build-secrets-T9xpsL:docker_id"
    DOCKER_PW: "arn:aws:secretsmanager:us-east-1:637574709554:secret:barbak-build-secrets-T9xpsL:docker_access_token"
phases:
  # install:
  #   runtime-versions:
  #     docker: 18
  build:
    commands:
    - echo Build started on `date`
    # Build the Docker images
    - echo Building the production Docker images...
    - docker build -t $DOCKER_ID/barbak-webserver ./webserver
    - docker build -t $DOCKER_ID/barbak-client ./client
    - docker build -t $DOCKER_ID/barbak-backend ./backend
    - docker build -t $DOCKER_ID/barbak-mongo ./mongo
    - docker build -t $DOCKER_ID/barbak-mysql ./mysql
    - docker build -t $DOCKER_ID/barbak-redis ./redis
    # Log In to the Docker CLI
    - echo $DOCKER_PW | docker login -u $DOCKER_ID --password-stdin
  post_build:
    commands:
    # Take these images and push them to Docker hub
    - echo Pushing to Docker images...
    - docker push $DOCKER_ID/barbak-webserver
    - docker push $DOCKER_ID/barbak-client
    - docker push $DOCKER_ID/barbak-backend
    - docker push $DOCKER_ID/barbak-mongo
    - docker push $DOCKER_ID/barbak-mysql
    - docker push $DOCKER_ID/barbak-redis